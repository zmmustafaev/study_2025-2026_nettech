---
## Front matter
title: "Отчёт по лабораторной работе 7"
subtitle: "Адресация IPv4 и IPv6. Настройка DHCP"
author: "Заур Мустафаев"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Получение навыков настройки службы DHCP на сетевом оборудовании для распределения адресов IPv4 и IPv6.

# Выполнение работы

## Создание топологии сети в GNS3

1. В среде GNS3 был создан новый проект.  
   На рабочем поле размещены три устройства:

   - PC1-zmustafaev  
   - zmustafaev-sw-01  
   - zmustafaev-gw-01  

   Устройства соединены последовательно: PC1 → коммутатор → маршрутизатор VyOS.

   ![Топология в GNS3](01.png){ #fig:001 width=70% }

## Установка и начальная настройка маршрутизатора VyOS

2. На маршрутизаторе была выполнена установка системы посредством стандартного установщика.  
   После завершения диалога установка была подтверждена, и устройство перезагружено.

3. После входа под пользователем vyos выполнен переход в режим конфигурирования.  
   На маршрутизаторе изменены имя узла, доменное имя, а также создан новый пользователь zmustafaev.  
   Далее конфигурация сохранена, выполнен выход и повторный вход уже под новым пользователем.  
   В завершение удалён стандартный пользователь vyos.

   ![Первичная настройка VyOS](02.png){ #fig:002 width=78% }

## Настройка IPv4 и DHCP-сервера на маршрутизаторе

4. На интерфейсе eth0 настроен IPv4-адрес 10.0.0.1/24.

5. На маршрутизаторе выполнена настройка DHCP-сервера.  
   Создана разделяемая сеть zmustafaev и подсеть 10.0.0.0/24.  
   Настроены параметры:

   - доменное имя: zmustafaev.net  
   - DNS-сервер: 10.0.0.1  
   - шлюз по умолчанию: 10.0.0.1  
   - диапазон выдачи адресов: 10.0.0.2–10.0.0.253  

   Конфигурация была успешно сохранена.

   ![Настройка DHCP-сервера](03.png){ #fig:003 width=80% }

## Получение IP-адреса клиентом PC1

6. На устройстве PC1-zmustafaev был запрошен адрес по DHCP с включённым выводом декодированной информации.  
   На экране отображены этапы DHCP-процесса:

   - Discover – клиент объявляет о себе  
   - Offer – сервер предлагает IP  
   - Request – клиент запрашивает конкретный адрес  
   - Ack – сервер подтверждает назначение  

   Клиент получил настройки:  
   IP 10.0.0.2/24, шлюз 10.0.0.1, DNS 10.0.0.1, домен zmustafaev.net.

   ![Ответ DHCP на PC1](04.png){ #fig:004 width=80% }

7. Конфигурация клиента была сохранена.  
   Проверена установленная адресация и выполнена проверка связности с маршрутизатором — ответы получены.

   ![Параметры IP на PC1](05.png){ #fig:005 width=80% }

## Анализ статистики DHCP-сервера

8. На маршрутизаторе просмотрена статистика DHCP-сервера и список активных аренд.  
   Зафиксирована одна активная аренда — адрес 10.0.0.2, выданный клиенту с MAC-адресом 00:50:79:66:68:00.

   ![Статистика DHCP-сервера](06.png){ #fig:006 width=85% }

9. Просмотр журнала DHCP показал последовательность событий Discover, Offer, Request и Ack.  
   Вся передача происходила через интерфейс eth0, что подтверждает корректную работу сервиса.

   ![Журнал DHCP-процессов](07.png){ #fig:007 width=85% }

## Анализ DHCP-трафика в Wireshark

10. В ходе захвата трафика между коммутатором и маршрутизатором были зафиксированы все ключевые DHCP-пакеты.  
    Каждый этап содержит служебные параметры:

    - идентификатор транзакции  
    - MAC-адрес клиента  
    - назначаемый IP-адрес  
    - маска подсети  
    - адрес шлюза  
    - DNS-сервер  
    - доменное имя zmustafaev.net  

    Это подтверждает корректность прохождения полного цикла DHCP.

    ![DHCP-трафик в Wireshark](08.png){ #fig:008 width=85% }

## Дополнение топологии и подготовка проекта

1. К ранее созданной сети были добавлены новые узлы и соединения в соответствии с топологией.  
   В проект были добавлены:

   - C1-zmustafaev  
   - zmustafaev-sw-02  
   - zmustafaev-sw-03  
   - PC2-zmustafaev (хост Kali Linux CLI)  
   - PC3-zmustafaev  

   Все элементы соединены в соответствии с требуемой схемой.

   ![Топология IPv6](09.png){ #fig:009 width=75% }

2. Всем устройствам присвоены имена по требуемому шаблону.  
   Дополнительно был включён захват трафика на каналах:

   - между zmustafaev-gw-01 и zmustafaev-sw-02  
   - между zmustafaev-gw-01 и zmustafaev-sw-03  

## Настройка IPv6 на маршрутизаторе VyOS

3. Маршрутизатор переведён в режим конфигурирования.  
   На интерфейсы были назначены IPv6-адреса:

   - eth1 → 2000::1/64  
   - eth2 → 2001::1/64  

   После назначения адресов была сохранена конфигурация.

   ![Настройка интерфейсов IPv6](10.png){ #fig:010 width=75% }

## Настройка Router Advertisements и DHCPv6 Stateless

4. На маршрутизаторе включена рассылка RA (Router Advertisements) на интерфейсе eth1.  
   Указан префикс 2000::/64 и включён флаг other-config-flag, позволяющий получать дополнительные параметры через DHCPv6.

5. Выполнено создание DHCPv6 Stateless-конфигурации:

   - создана разделяемая сеть zmustafaev-stateless  
   - указан префикс 2000::/64  
   - в общих параметрах назначено:  
     — DNS-сервер 2000::1  
     — domain-search: zmustafaev.net  

   ![Настройка DHCPv6 Stateless](11.png){ #fig:011 width=75% }

## Проверка IPv6 на узле PC2 (Kali Linux)

6. На PC2 проверены параметры сетевого интерфейса:

   - интерфейс eth0 получил адрес из префикса 2000::/64 посредством SLAAC  
   - таблица маршрутов содержит маршрут по умолчанию через fe80::/64  
   - подтверждено получение связности с маршрутизатором

   ![Проверка IPv6 на PC2](12.png){ #fig:012 width=75% }

7. Проверена связность с маршрутизатором:

   - два ICMPv6-эхо-запроса к адресу 2000::1 прошли успешно  

8. Проверен файл resolv.conf — обнаружены значения, переданные сервером:

   - search zmustafaev.net  
   - nameserver 2000::1  

## Получение информации DHCPv6

9. На PC2 выполнен запрос DHCPv6-параметров с использованием клиента dhclient:  
   После выполнения запроса узел получил только конфигурационные параметры (DNS и домен), что соответствует режиму stateless.

   ![Запрос DHCPv6-параметров](13.png){ #fig:013 width=75% }

10. Повторная проверка связности и содержимого resolv.conf подтвердила работу DHCPv6 Stateless.

## Анализ DHCPv6 на маршрутизаторе

11. На маршрутизаторе были запрошены активные назначения DHCPv6:

   - таблица назначений пуста, что соответствует Stateless-режиму (адреса не выдаются, только параметры)

   ![Просмотр DHCPv6 аренд](14.png){ #fig:014 width=85% }

## Анализ трафика DHCPv6 в Wireshark

12. В захваченных пакетах наблюдаются процессы:

   - Router Advertisement от маршрутизатора (RA)  
   - DHCPv6 Information-Request от клиента  
   - DHCPv6 Reply от сервера с параметрами:  
     — Client Identifier  
     — Server Identifier  
     — Domain Search: zmustafaev.net  
     — DNS-server: 2000::1  

   Пакеты DHCPv6 содержат:

   - DUID клиента  
   - DUID сервера  
   - тип сообщения (Reply)  
   - transaction ID  

   Это подтверждает корректную работу режима DHCPv6 Stateless.

   ![DHCPv6 трафик Wireshark](15.png){ #fig:015 width=85% }

## Настройка DHCPv6 Stateful на маршрутизаторе

13. На интерфейсе eth2 маршрутизатора была включена поддержка DHCPv6 Stateful с помощью установки флага managed-flag в Router Advertisements.  
    Это означает, что узлы будут получать IPv6-адреса **только** через DHCPv6, а SLAAC будет использоваться лишь для вспомогательных параметров.

    Далее была создана новая разделяемая сеть:

   - название: zmustafaev-stateful  
   - подсеть: 2001::/64  
   - DNS-сервер: 2001::1  
   - доменное имя: zmustafaev.net  
   - диапазон выдаваемых адресов: 2001::100 – 2001::199  

   Конфигурация сохранена.

   ![Настройка DHCPv6 Stateful](16.png){ #fig:016 width=85% }

## Проверка конфигурации на PC3

14. На маршрутизаторе был просмотрен список активных DHCPv6-аренд.  
    До получения адреса клиентом таблица пуста.

15. На узле PC3 (Kali Linux) были проверены текущие параметры IPv6.  
    Интерфейс получил только link-local адрес (fe80::/64), так как полный адрес назначается после получения ответа DHCPv6.

16. Файл resolv.conf содержал параметры DNS, полученные ранее или установленные системой.

   ![Проверка IPv6 и DNS на PC3 до DHCPv6](17.png){ #fig:017 width=85% }

## Получение IPv6-адреса по DHCPv6

17. На PC3 был выполнен запрос DHCPv6:

   Команда инициировала обмен:

   - Solicit →  
   - Advertise ←  
   - Request →  
   - Reply ←  

   В результате PC3 получил адрес типа non-temporary из заданного диапазона.

   ![Процесс получения DHCPv6-адреса](18.png){ #fig:018 width=85% }

## Проверка настроек PC3 после получения адреса

18. После завершения DHCPv6-обмена:

   - интерфейс eth0 получил адрес, например 2001::198  
   - в таблице маршрутов появился маршрут по умолчанию (через fe80::* шлюз)  
   - файл resolv.conf обновился и содержит:  
     — search zmustafaev.net  
     — nameserver 2001::1  

   Проверка связности с маршрутизатором прошла успешно (ping 2001::1).

   ![Параметры PC3 после получения DHCPv6](19.png){ #fig:019 width=85% }
   
   ![Проверка связности](20.png){ #fig:020 width=85% }


## Просмотр аренд на маршрутизаторе

19. После получения адреса PC3 таблица DHCPv6-аренд маршрутизатора отобразила:

   - выделенный адрес  
   - состояние active  
   - срок действия аренды  
   - IAID/DUID клиента  
   - пул: zmustafaev-stateful  

   ![Таблица активных DHCPv6 аренд](21.png){ #fig:021 width=85% }

## Анализ трафика DHCPv6 в Wireshark

20. В захваченном трафике чётко прослеживается полный DHCPv6 Stateful цикл:

   - Solicit от PC3  
   - Advertise от маршрутизатора  
   - Request от PC3  
   - Reply с назначением адреса из диапазона 2001::100–2001::199  

   В пакетах просматриваются:

   - DUID клиента и сервера  
   - IA_NA (Identity Association for Non-Temporary Address)  
   - выданный адрес  
   - lifetimes (preferred, valid)  
   - информация о DNS  

   Это подтверждает полную корректность работы DHCPv6 с отслеживанием состояния.

   ![DHCPv6 Stateful трафик в Wireshark](22.png){ #fig:022 width=85% }

# Вывод

В ходе выполнения работы была смоделирована расширенная IPv6-инфраструктура, включающая маршрутизатор **VyOS**, коммутаторы и два клиента на базе **Kali Linux**.  
Пошагово были реализованы два механизма автоматической настройки адресов — **DHCPv6 Stateless** и **DHCPv6 Stateful**.  

Для Stateless-конфигурации клиенты успешно получали параметры DNS и доменное имя через DHCPv6, а IPv6-адрес формировался с использованием SLAAC.  
Для Stateful-конфигурации маршрутизатор выдавал IPv6-адреса из заданного пула, что подтверждено как на стороне узлов, так и в таблице аренд маршрутизатора.  

Захваченный в Wireshark трафик демонстрирует корректный обмен DHCPv6-сообщениями (Solicit, Advertise, Request, Reply), работу RA-механизма и полное соответствие протоколу.  
Проверка маршрутизации и сетевой связности подтверждает правильность настройки и корректное функционирование сети.  
Полученные результаты подтверждают работоспособность DHCPv6 в обеих конфигурациях и корректную работу IPv6-адресации в смоделированной топологии.

