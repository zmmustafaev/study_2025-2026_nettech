---
## Front matter
title: "Отчёт по лабораторной работе 6"
subtitle: "Адресация IPv4 и IPv6. Двойной стек"
author: "Заур Мустафаев"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: IBM Plex Serif
romanfont: IBM Plex Serif
sansfont: IBM Plex Sans
monofont: IBM Plex Mono
mathfont: STIX Two Math
mainfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
romanfontoptions: Ligatures=Common,Ligatures=TeX,Scale=0.94
sansfontoptions: Ligatures=Common,Ligatures=TeX,Scale=MatchLowercase,Scale=0.94
monofontoptions: Scale=MatchLowercase,Scale=0.94,FakeStretch=0.9
mathfontoptions:
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Изучение принципов распределения и настройки адресного пространства на устройствах сети.

# Выполнение работы

## Разбиение IPv4-сети на подсети

### Сеть 172.16.20.0/24

**Характеристики исходной сети**
- Префикс: /24
- Маска: 255.255.255.0
- Broadcast: 172.16.20.255
- Диапазон узлов: 172.16.20.1 – 172.16.20.254
- Число адресов / узлов: 256 адресов, 254 узла

**Сколько подсетей можно получить из /24 (если дробить на равные части):**
- /25 → 2 подсети
- /26 → 4 подсети
- /27 → 8 подсетей
- /28 → 16 подсетей
- /29 → 32 подсети
- /30 → 64 подсети

**Требуемое VLSM-разбиение: 126, 62, 62 узла**
- Для 126 узлов нужен блок /25 (128 адресов)
- Для 62 узлов нужен блок /26 (64 адреса)

Разбиваем по убыванию:

| Подсеть | Префикс | Сетевой адрес      | Диапазон узлов                | Broadcast        | Узлов |
|---|---:|---|---|---|---:|
| №1 (126) | /25 | 172.16.20.0         | 172.16.20.1 – 172.16.20.126   | 172.16.20.127    | 126 |
| №2 (62)  | /26 | 172.16.20.128       | 172.16.20.129 – 172.16.20.190 | 172.16.20.191    | 62  |
| №3 (62)  | /26 | 172.16.20.192       | 172.16.20.193 – 172.16.20.254 | 172.16.20.255    | 62  |

### Сеть 10.10.1.64/26

**Характеристики исходной сети**
- Префикс: /26
- Маска: 255.255.255.192
- Сетевой адрес: 10.10.1.64
- Broadcast: 10.10.1.127
- Диапазон узлов: 10.10.1.65 – 10.10.1.126
- Адресов всего / узлов: 64 адреса, 62 узла
- В рамках /24 (10.10.1.0/24) разбиение на /26 даёт 4 подсети: .0/26, .64/26, .128/26, .192/26

**Выделить подсеть на 30 узлов**
- Требуется /27 (32 адреса, 30 узлов)
- Внутри 10.10.1.64/26 доступно два блока /27: 10.10.1.64/27 и 10.10.1.96/27

Характеристики выбранной подсети (пример: **10.10.1.64/27**):
- Маска: 255.255.255.224
- Сетевой адрес: 10.10.1.64
- Broadcast: 10.10.1.95
- Диапазон узлов: 10.10.1.65 – 10.10.1.94
- Узлов: 30

(Альтернативный блок: 10.10.1.96/27 с узлами 10.10.1.97 – 10.10.1.126 и broadcast 10.10.1.127.)

### Сеть 10.10.1.0/26

**Характеристики исходной сети**
- Префикс: /26
- Маска: 255.255.255.192
- Сетевой адрес: 10.10.1.0
- Broadcast: 10.10.1.63
- Диапазон узлов: 10.10.1.1 – 10.10.1.62
- Адресов всего / узлов: 64 адреса, 62 узла
- В рамках /24 разбиение на /26 даёт 4 подсети: .0/26, .64/26, .128/26, .192/26

**Выделить подсеть на 14 узлов**
- Требуется /28 (16 адресов, 14 узлов)
- Внутри 10.10.1.0/26 доступны четыре блока /28: 10.10.1.0/28, 10.10.1.16/28, 10.10.1.32/28, 10.10.1.48/28

Характеристики выбранной подсети (пример: **10.10.1.16/28**):
- Маска: 255.255.255.240
- Сетевой адрес: 10.10.1.16
- Broadcast: 10.10.1.31
- Диапазон узлов: 10.10.1.17 – 10.10.1.30
- Узлов: 14

(Альтернативные /28 в этом /26: .0/28, .32/28, .48/28.)

### Разбиение IPv6-сети на подсети

### Сеть 2001:db8:c0de::/48

**Характеристика**
- Префикс: /48  
- Маска (в двоичном виде): 48 единиц + 80 нулей  
- Фиксированы первые три хекстета: `2001:db8:c0de`  
- Диапазон адресов (краевые значения):
  - минимальный: 2001:db8:c0de::  
  - максимальный: 2001:db8:c0de:ffff:ffff:ffff:ffff:ffff
- Особенности: broadcast в IPv6 отсутствует; адрес с IID=0 — это *subnet-router anycast* для данного /64.

Разбиение на 2 подсети — способ A (используем **идентификатор подсети**, Subnet ID)
Берём 1 бит из поля Subnet ID (которое в /48 занимает 16 бит — четвёртый хекстет) → получаем две подсети **/49**:

| Подсеть | Префикс | Диапазон (краевые значения) |
|---|---|---|
| A | 2001:db8:c0de:0::/49 | 2001:db8:c0de:0:: – 2001:db8:c0de:7fff:ffff:ffff:ffff:ffff |
| B | 2001:db8:c0de:8000::/49 | 2001:db8:c0de:8000:: – 2001:db8:c0de:ffff:ffff:ffff:ffff:ffff |

Разбиение на 2 подсети — способ B (используем **идентификатор интерфейса**, Interface ID)
Выделим один бит уже из IID (после /64). Это даёт две подсети **/65** внутри любого выбранного /64.  
Например, возьмём первый /64: `2001:db8:c0de:0::/64` и разобьём его:

| Подсеть | Префикс | Диапазон (краевые значения) |
|---|---|---|
| A | 2001:db8:c0de:0::/65 | 2001:db8:c0de:0:0000:: – 2001:db8:c0de:0:7fff:ffff:ffff:ffff |
| B | 2001:db8:c0de:0:8000::/65 | 2001:db8:c0de:0:8000:: – 2001:db8:c0de:0:ffff:ffff:ffff:ffff |

### Сеть 2a02:6b8::/64

**Характеристика**
- Префикс: /64 (рекомендованный размер подсети в IPv6)  
- Фиксированы первые четыре хекстета: `2a02:6b8:0:0`  
- Диапазон адресов (краевые значения):
  - минимальный: 2a02:6b8::  
  - максимальный: 2a02:6b8::ffff:ffff:ffff:ffff
- Особенности: broadcast нет; адрес с IID=0 — *subnet-router anycast* для этого /64.

Разбиение на 2 подсети — способ A (через **идентификатор подсети**)
В сети с префиксом **/64 поле Subnet ID отсутствует** (всё, что правее, — это IID).  
Поэтому «разбить по Subnet ID» **невозможно без изменения исходного префикса**. Формально можно было бы рассматривать агрегат /63 и получить два /64, но это будет уже другая исходная сеть.

Разбиение на 2 подсети — способ B (через **идентификатор интерфейса**, IID)
Берём 1 бит из IID → получаем две подсети **/65**:

| Подсеть | Префикс | Диапазон (краевые значения) |
|---|---|---|
| A | 2a02:6b8::/65 | 2a02:6b8:0:0:0000:: – 2a02:6b8:0:0:7fff:ffff:ffff:ffff |
| B | 2a02:6b8:0:0:8000::/65 | 2a02:6b8:0:0:8000:: – 2a02:6b8:0:0:ffff:ffff:ffff:ffff |

## Настройка двойного стека адресации IPv4 и IPv6 в локальной сети

1. Запущены GNS3 VM и приложение **GNS3**, создан новый проект.  
   На рабочем поле размещены и соединены устройства согласно заданной топологии.

   Используемые устройства:
   - VPCS — конечные узлы (PC1, PC2, PC3, PC4, server)
   - Коммутаторы Ethernet
   - Маршрутизатор **FRR** — для подсети IPv4
   - Маршрутизатор **VyOS** — для будущей подсети IPv6

   Устройствам назначены имена:
   - ПК: `PCx-zmustafaev`
   - Коммутаторы: `msk-zmustafaev-sw-0x`
   - Маршрутизатор: `msk-zmustafaev-gw-01`

   ![Созданная топология сети](Screenshot_1.png){ width=85% }

### Настройка IPv4 на узлах PC1, PC2 и сервере

2. В консоли VPCS выполнена настройка адреса и шлюза по умолчанию.

PC1-zmustafaev

Назначение адреса:

`ip 172.16.20.10/25 172.16.20.1`  
`save`

Просмотр конфигурации IP и IPv6: `show ip`, `show ipv6`

![PC1 — вывод конфигурации IP](Screenshot_2.png){ width=75% }

PC2-zmustafaev

Назначение адреса:

`ip 172.16.20.138/25 172.16.20.129`  
`save`

Просмотр конфигурации IP и IPv6: `show ip`, `show ipv6`

![PC2 — вывод конфигурации IP](Screenshot_3.png){ width=75% }

server-zmustafaev (Dual Stack Server)

Назначение адреса:

`ip 64.100.1.10/24 64.100.1.1`  
`save`

Просмотр конфигурации IP и IPv6: `show ip`, `show ipv6`

![Server — вывод конфигурации IP](Screenshot_4.png){ width=75% }

### Настройка маршрутизатора FRR (msk-zmustafaev-gw-01)

3. Выполнена конфигурация адресов интерфейсов:

- `eth0 → 172.16.20.1/25`
- `eth1 → 172.16.20.129/25`
- `eth2 → 64.100.1.1/24`

![Настройка интерфейсов на FRR](Screenshot_5.png){ width=75% }

### Проверка сохранённой конфигурации

Команды:

- просмотр конфигурации — `show running-config`
- просмотр интерфейсов — `show interface brief`

![Вывод running-config](Screenshot_6.png){ width=65% }
![Информация об интерфейсах](Screenshot_7.png){ width=65% }

### Проверка сетевой связности

4. С ПК PC1 выполнена проверка доступности других узлов.

Ping и trace до PC2 (172.16.20.138)

![Ping и trace до PC2](Screenshot_8.png){ width=70% }

Ping и trace до сервера (64.100.1.10)

![Ping и trace до сервера](Screenshot_9.png){ width=70% }

### Настройка IPv6 на узлах PC3, PC4 и сервере

9. На узлах PC3, PC4 и сервере выполнена настройка IPv6-адресов.

Для PC3 было назначено:
ip 2001:db8:c0de:12::a/64
save

Для PC4 было назначено:
ip 2001:db8:c0de:13::a/64
save

Для сервера (Dual Stack Server):
ip 2001:db8:c0de:11::a/64
save

На каждом узле просмотрены настройки IPv4 и IPv6: show ip и show ipv6.

PC3 — конфигурация IPv6
![PC3 IPv6](Screenshot_10.png)

PC4 — конфигурация IPv6
![PC4 IPv6](Screenshot_11.png)

Server — конфигурация IPv6
![Server IPv6](Screenshot_12.png)

### Настройка маршрутизатора VyOS (msk-zmustafaev-gw-02)

10. На маршрутизатор установлен VyOS, задано имя устройства msk-zmustafaev-gw-02 и выполнена настройка IPv6 интерфейсов.

Назначены адреса:

- eth0 → 2001:db8:c0de:12::1/64
- eth1 → 2001:db8:c0de:13::1/64
- eth2 → 2001:db8:c0de:11::1/64

Также включена рассылка Router Advertisements для автоконфигурации IPv6 клиентов.

![VyOS настройка](Screenshot_13.png)

После внесения конфигурации выполнены команды commit и save.

Проверка интерфейсов:
![VyOS интерфейсы](Screenshot_14.png)

### Проверка сетевой связности IPv6

11. С PC3 выполнена проверка связи с PC4 и сервером.

Проверка ping и trace:
![PC3 Проверка IPv6](Screenshot_15.png)

С PC3 невозможно обратиться к подсети IPv4, что подтверждает корректность разделения стека.

12. С сервера (Dual Stack Server) выполнены проверки ping по IPv6 и IPv4:

- Успешный обмен ICMPv6 сообщениями с PC3 и PC4
- Успешный обмен ICMPv4 с PC2 (проверка двойного стека)

![Server — проверки ping](Screenshot_16.png)

### Анализ перехваченного трафика

13. Включён захват пакетов на соединении сервера с коммутатором.  
   В анализе отображаются ARP, ICMP и ICMPv6 кадры.

ARP-запрос отображает:
- MAC-адрес источника
- IP-адрес источника
- IP-адрес устройства, MAC которого требуется определить

![ARP](Screenshot_17.png)

Пакет ICMP содержит:
- тип сообщения (Echo Request или Echo Reply)
- время ответа
- адрес отправителя и получателя

![ICMP](Screenshot_18.png)

Пример ICMPv6

Здесь видно:
- ICMPv6 Echo Request / Reply
- используемые IPv6 адреса
- поле Sequence Number

![ICMPv6](Screenshot_19.png)

## Самостоятельное задание

### Характеристика подсетей

Подсеть 1 — IPv4: 10.10.1.96/27
- Маска: 255.255.255.224
- Размер: 32 адреса (30 хостов)
- Сетевой адрес: 10.10.1.96
- Диапазон хостов: 10.10.1.97 – 10.10.1.126
- Широковещательный: 10.10.1.127

Подсеть 2 — IPv4: 10.10.1.16/28
- Маска: 255.255.255.240
- Размер: 16 адресов (14 хостов)
- Сетевой адрес: 10.10.1.16
- Диапазон хостов: 10.10.1.17 – 10.10.1.30
- Широковещательный: 10.10.1.31

Подсеть 1 — IPv6: 2001:db8:1:1::/64
- Размер / особенности: /64, адреса для SLAAC, широковещание отсутствует (используется многовещание)
- Пример хоста: 2001:db8:1:1::a
- Адрес интерфейса маршрутизатора (минимальный): 2001:db8:1:1::1

Подсеть 2 — IPv6: 2001:db8:1:4::/64
- Размер / особенности: /64, адреса для SLAAC, широковещание отсутствует
- Пример хоста: 2001:db8:1:4::a
- Адрес интерфейса маршрутизатора (минимальный): 2001:db8:1:4::1

### Таблица адресации

| Устройство / Интерфейс | IPv4 адрес / маска      | Шлюз (IPv4) | IPv6 адрес / префикс     | Примечание |
|---|---|---:|---|---|
| msk-sw-zmustafaev-gw-01 `eth0` | 10.10.1.97/27  | — | 2001:db8:1:1::1/64 | Мин. адрес подсети 1 |
| msk-sw-zmustafaev-gw-01 `eth1` | 10.10.1.17/28  | — | 2001:db8:1:4::1/64 | Мин. адрес подсети 2 |
| PC1-zmustafaev (подсеть 1)     | 10.10.1.100/27 | 10.10.1.97 | 2001:db8:1:1::a/64 | Хост подсети 1 |
| PC2-zmustafaev (подсеть 2)     | 10.10.1.20/28  | 10.10.1.17 | 2001:db8:1:4::a/64 | Хост подсети 2 |

Топология:

![Топология](Screenshot_20.png)

### Настройка адресации

Маршрутизатор VyOS (msk-sw-zmustafaev-gw-01)
- `eth0`: 10.10.1.97/27, 2001:db8:1:1::1/64; включён Router Advertisement для `2001:db8:1:1::/64`
- `eth1`: 10.10.1.17/28, 2001:db8:1:4::1/64; включён Router Advertisement для `2001:db8:1:4::/64`

Снимок конфигурации:
![VyOS config](Screenshot_23.png)

Конечные устройства

**PC1-zmustafaev**
- IPv4: 10.10.1.100/27, GW 10.10.1.97
- IPv6: 2001:db8:1:1::a/64
![PC1 IP](Screenshot_21.png)

**PC2-zmustafaev**
- IPv4: 10.10.1.20/28, GW 10.10.1.17
- IPv6: 2001:db8:1:4::a/64
![PC2 IP](Screenshot_22.png)

### 4. Проверка связности

IPv4
- `PC1 → PC2`: успешные `ping`, маршрут через шлюз 10.10.1.97
![IPv4 ping/trace](Screenshot_24.png)

IPv6
- `PC1 → PC2` по адресам `2001:db8:1:4::a`: успешные `ping` и `trace` через `2001:db8:1:1::1`
![IPv6 ping/trace](Screenshot_25.png)

# Вывод

В ходе лабораторной работы были смоделированы сети на маршрутизаторах **FRR** и **VyOS**, выполнена IP-настройка и проверена связность. Анализ ICMP- и ARP-трафика подтвердил корректную работу сети и маршрутизаторов.
